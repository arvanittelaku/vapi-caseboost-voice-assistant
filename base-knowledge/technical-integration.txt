# Technical Integration & API Details

## GoHighLevel CRM Integration

### API Configuration
- **Version**: v1 REST API
- **Base URL**: `https://rest.gohighlevel.com/v1/contacts/`
- **Authentication**: Bearer token
- **Environment Variables**:
  - `GOHIGHLEVEL_API_KEY`: Sub-account API key
  - `GOHIGHLEVEL_LOCATION_ID`: Sub-account Location ID

### Contact Creation Endpoint
```javascript
POST https://rest.gohighlevel.com/v1/contacts/
Headers:
  Authorization: Bearer ${GOHIGHLEVEL_API_KEY}
  Accept: application/json
  Content-Type: application/json
```

### Payload Structure
```json
{
  "firstName": "John",
  "lastName": "Doe", 
  "email": "john@example.com",
  "phone": "+44 20 3967 3689",
  "companyName": "Law Firm Name",
  "source": "Website Contact Form",
  "locationId": "YOUR_LOCATION_ID",
  "customField": [
    { "id": "practice_area", "value": "Personal Injury" },
    { "id": "urgency_level", "value": "ASAP" },
    { "id": "budget_range", "value": "£10,000 - £25,000" },
    { "id": "message", "value": "Form message text" }
  ]
}
```

## Custom Field Mappings

### Standard Fields
- `practice_area`: Primary legal practice area
- `urgency_level`: How quickly client needs help
- `budget_range`: Monthly marketing budget
- `message`: Additional information or requirements
- `practice_region`: Geographic service area
- `firm_size`: Size of law firm
- `needs`: Service type preference
- `marketing_budget`: Budget for marketing services
- `cases_monthly`: Target cases per month
- `marketing_activities`: Current marketing efforts
- `additional_information`: Extra details about firm

### Form Source Tracking
- `"Website Contact Form"`: General contact inquiries
- `"Website Request Clients Form"`: Detailed lead qualification

## Error Handling & Fallback Strategy

### Common Errors
- **401 Unauthorized**: Invalid API key or Location ID
- **422 Unprocessable Entity**: Invalid custom field IDs or validation errors

### Fallback Process
1. Try contact creation with custom fields
2. If 422 error, retry without custom fields
3. Add custom field data as contact note
4. Log error for debugging

### Contact Note Fallback
```javascript
POST https://rest.gohighlevel.com/v1/contacts/{CONTACT_ID}/notes/
{
  "body": "Form Details:\npractice_area: Personal Injury\nurgency_level: ASAP",
  "locationId": "YOUR_LOCATION_ID"
}
```

## Netlify Functions

### Submit Contact Function
- **Path**: `/netlify/functions/submit-contact.js`
- **Method**: POST
- **CORS**: Enabled for all origins
- **Error Handling**: Comprehensive with fallback strategies

### Health Check Function
- **Path**: `/netlify/functions/health.js`
- **Purpose**: Verify API configuration
- **Returns**: API key and Location ID status

## VAPI Integration Points

### Voice Data Collection
- **Contact Information**: Name, email, phone, firm name
- **Practice Details**: Area, region, firm size, urgency
- **Service Preferences**: Custom system vs ready leads
- **Budget Information**: Monthly budget range
- **Case Goals**: Target cases per month
- **Current Marketing**: Existing marketing activities

### Real-time CRM Updates
- **Immediate Contact Creation**: During or after call
- **Custom Field Population**: Voice data to CRM fields
- **Source Tracking**: Voice assistant as lead source
- **Follow-up Triggers**: Automated sequences based on voice data

### Data Validation
- **Email Format**: Standard email validation
- **Phone Format**: UK phone number formatting
- **Required Fields**: Name, email, practice area minimum
- **Custom Field Validation**: Ensure field IDs exist in GoHighLevel

## Security Considerations

### API Key Protection
- **Server-side Only**: Never expose API keys client-side
- **Environment Variables**: Secure storage in deployment platform
- **Key Rotation**: Regular API key updates
- **Access Logging**: Monitor API usage and access

### Data Privacy
- **GDPR Compliance**: EU data protection requirements
- **Data Minimization**: Collect only necessary information
- **Consent Tracking**: Record user consent for data processing
- **Data Retention**: Implement appropriate retention policies

### Error Handling
- **User-friendly Messages**: Don't expose technical errors
- **Logging**: Detailed server-side error logging
- **Monitoring**: API response time and error rate tracking
- **Fallback Communication**: Alternative contact methods if API fails
